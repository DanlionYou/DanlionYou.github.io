import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as e,f as a,o as t}from"./app-utPN4a2m.js";const n="/assets/%E5%86%85%E5%AD%98%E5%8C%BA%E5%9F%9F%E5%B8%B8%E8%A7%81%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0-BhVyMqLd.png",l={};function r(h,i){return t(),e("div",null,i[0]||(i[0]=[a('<blockquote><p>æœ¬æ–‡ç”± JavaGuide ç¿»è¯‘è‡ª <a href="https://www.baeldung.com/jvm-parameters" target="_blank" rel="noopener noreferrer">https://www.baeldung.com/jvm-parameters</a>ï¼Œå¹¶å¯¹æ–‡ç« è¿›è¡Œäº†å¤§é‡çš„å®Œå–„è¡¥å……ã€‚<br> æ–‡æ¡£å‚æ•° <a href="https://docs.oracle.com/javase/8/docs/technotes/tools/unix/java.html" target="_blank" rel="noopener noreferrer">https://docs.oracle.com/javase/8/docs/technotes/tools/unix/java.html</a></p><p>JDK ç‰ˆæœ¬ï¼š1.8 ä¸ºä¸»ï¼Œä¹Ÿä¼šè¡¥å……æ–°ç‰ˆæœ¬å¸¸ç”¨å‚æ•°</p></blockquote><p>åœ¨æœ¬ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä¸€èµ·æŒæ¡ Java è™šæ‹Ÿæœºï¼ˆJVMï¼‰ä¸­æœ€å¸¸ç”¨çš„ä¸€äº›å‚æ•°é…ç½®ï¼Œå¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å’Œè°ƒä¼˜ Java åº”ç”¨çš„è¿è¡Œç¯å¢ƒã€‚</p><h2 id="å †å†…å­˜ç›¸å…³" tabindex="-1"><a class="header-anchor" href="#å †å†…å­˜ç›¸å…³"><span>å †å†…å­˜ç›¸å…³</span></a></h2><blockquote><p>Java å †ï¼ˆJava Heapï¼‰æ˜¯ JVM æ‰€ç®¡ç†çš„å†…å­˜ä¸­æœ€å¤§çš„ä¸€å—åŒºåŸŸï¼Œ<strong>æ‰€æœ‰çº¿ç¨‹å…±äº«</strong>ï¼Œåœ¨è™šæ‹Ÿæœºå¯åŠ¨æ—¶åˆ›å»ºã€‚<strong>æ­¤å†…å­˜åŒºåŸŸçš„å”¯ä¸€ç›®çš„å°±æ˜¯å­˜æ”¾å¯¹è±¡å®ä¾‹ï¼Œå‡ ä¹æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹ä»¥åŠæ•°ç»„éƒ½è¦åœ¨å †ä¸Šåˆ†é…å†…å­˜ã€‚</strong></p></blockquote><p><img src="'+n+`" alt="å†…å­˜åŒºåŸŸå¸¸è§é…ç½®å‚æ•°"></p><h3 id="è®¾ç½®å †å†…å­˜å¤§å°-xms-å’Œ-xmx" tabindex="-1"><a class="header-anchor" href="#è®¾ç½®å †å†…å­˜å¤§å°-xms-å’Œ-xmx"><span>è®¾ç½®å †å†…å­˜å¤§å° (-Xms å’Œ -Xmx)</span></a></h3><p>æ ¹æ®åº”ç”¨ç¨‹åºçš„å®é™…éœ€æ±‚è®¾ç½®åˆå§‹å’Œæœ€å¤§å †å†…å­˜å¤§å°ï¼Œæ˜¯æ€§èƒ½è°ƒä¼˜ä¸­æœ€å¸¸è§çš„å®è·µä¹‹ä¸€ã€‚<strong>æ¨èæ˜¾å¼è®¾ç½®è¿™ä¸¤ä¸ªå‚æ•°ï¼Œå¹¶ä¸”é€šå¸¸å»ºè®®å°†å®ƒä»¬è®¾ç½®ä¸ºç›¸åŒçš„å€¼</strong>ï¼Œä»¥é¿å…è¿è¡Œæ—¶å †å†…å­˜çš„åŠ¨æ€è°ƒæ•´å¸¦æ¥çš„æ€§èƒ½å¼€é”€ã€‚</p><p>ä½¿ç”¨ä»¥ä¸‹å‚æ•°è¿›è¡Œè®¾ç½®ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">-Xms</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;heap </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">siz</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">e&gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">[unit]</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # è®¾ç½® JVM åˆå§‹å †å¤§å°</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">-Xmx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;heap </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">siz</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">e&gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">[unit]</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # è®¾ç½® JVM æœ€å¤§å †å¤§å°</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>&lt;heap size&gt;</code>: æŒ‡å®šå†…å­˜çš„å…·ä½“æ•°å€¼ã€‚</li><li><code>[unit]</code>: æŒ‡å®šå†…å­˜çš„å•ä½ï¼Œå¦‚ g (GB)ã€m (MB)ã€k (KB)ã€‚</li></ul><p><strong>ç¤ºä¾‹ï¼š</strong> å°† JVM çš„åˆå§‹å †å’Œæœ€å¤§å †éƒ½è®¾ç½®ä¸º 4GBï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">-Xms4G</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -Xmx4G</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="è®¾ç½®æ–°ç”Ÿä»£å†…å­˜å¤§å°-young-generation" tabindex="-1"><a class="header-anchor" href="#è®¾ç½®æ–°ç”Ÿä»£å†…å­˜å¤§å°-young-generation"><span>è®¾ç½®æ–°ç”Ÿä»£å†…å­˜å¤§å° (Young Generation)</span></a></h3><p>æ ¹æ®<a href="https://docs.oracle.com/javase/8/docs/technotes/guides/vm/gctuning/sizing.html" target="_blank" rel="noopener noreferrer">Oracle å®˜æ–¹æ–‡æ¡£</a>ï¼Œåœ¨å †æ€»å¯ç”¨å†…å­˜é…ç½®å®Œæˆä¹‹åï¼Œç¬¬äºŒå¤§å½±å“å› ç´ æ˜¯ä¸º <code>Young Generation</code> åœ¨å †å†…å­˜æ‰€å çš„æ¯”ä¾‹ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒYG çš„æœ€å°å¤§å°ä¸º <strong>1310 MB</strong>ï¼Œæœ€å¤§å¤§å°ä¸º <strong>æ— é™åˆ¶</strong>ã€‚</p><p>å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼è®¾ç½®æ–°ç”Ÿä»£å†…å­˜å¤§å°ï¼š</p><p><strong>1.é€šè¿‡<code>-XX:NewSize</code>å’Œ<code>-XX:MaxNewSize</code>æŒ‡å®š</strong></p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">-XX:NewSize</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;young </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">siz</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">e&gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">[unit]</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # è®¾ç½®æ–°ç”Ÿä»£åˆå§‹å¤§å°</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">-XX:MaxNewSize</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;young </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">siz</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">e&gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">[unit]</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> # è®¾ç½®æ–°ç”Ÿä»£æœ€å¤§å¤§å°</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ç¤ºä¾‹ï¼š</strong> è®¾ç½®æ–°ç”Ÿä»£æœ€å° 512MBï¼Œæœ€å¤§ 1024MBï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">-XX:NewSize</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">=512m</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -XX:MaxNewSize=1024m</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>2.é€šè¿‡<code>-Xmn&lt;young size&gt;[unit]</code>æŒ‡å®š</strong></p><p><strong>ç¤ºä¾‹ï¼š</strong> å°†æ–°ç”Ÿä»£å¤§å°å›ºå®šä¸º 512MBï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">-Xmn512m</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>GC è°ƒä¼˜ç­–ç•¥ä¸­å¾ˆé‡è¦çš„ä¸€æ¡ç»éªŒæ€»ç»“æ˜¯è¿™æ ·è¯´çš„ï¼š</p><blockquote><p>å°½é‡è®©æ–°åˆ›å»ºçš„å¯¹è±¡åœ¨æ–°ç”Ÿä»£åˆ†é…å†…å­˜å¹¶è¢«å›æ”¶ï¼Œå› ä¸º Minor GC çš„æˆæœ¬é€šå¸¸è¿œä½äº Full GCã€‚é€šè¿‡åˆ†æ GC æ—¥å¿—ï¼Œåˆ¤æ–­æ–°ç”Ÿä»£ç©ºé—´åˆ†é…æ˜¯å¦åˆç†ã€‚å¦‚æœå¤§é‡æ–°å¯¹è±¡è¿‡æ—©è¿›å…¥è€å¹´ä»£ï¼ˆPromotionï¼‰ï¼Œå¯ä»¥é€‚å½“é€šè¿‡ <code>-Xmn</code> æˆ– -<code>XX:NewSize/-XX:MaxNewSize</code> è°ƒæ•´æ–°ç”Ÿä»£å¤§å°ï¼Œç›®æ ‡æ˜¯æœ€å¤§é™åº¦åœ°å‡å°‘å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£çš„æƒ…å†µã€‚</p></blockquote><p>å¦å¤–ï¼Œä½ è¿˜å¯ä»¥é€šè¿‡ <strong><code>-XX:NewRatio=&lt;int&gt;</code></strong> å‚æ•°æ¥è®¾ç½®<strong>è€å¹´ä»£ä¸æ–°ç”Ÿä»£ï¼ˆä¸å« Survivor åŒºï¼‰çš„å†…å­˜å¤§å°æ¯”ä¾‹</strong>ã€‚</p><p>ä¾‹å¦‚ï¼Œ<code>-XX:NewRatio=2</code> ï¼ˆé»˜è®¤å€¼ï¼‰è¡¨ç¤ºè€å¹´ä»£ : æ–°ç”Ÿä»£ = 2 : 1ã€‚å³æ–°ç”Ÿä»£å æ•´ä¸ªå †å¤§å°çš„ 1/3ã€‚</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">-XX:NewRatio</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">=2</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="è®¾ç½®æ°¸ä¹…ä»£-å…ƒç©ºé—´å¤§å°-permgen-metaspace" tabindex="-1"><a class="header-anchor" href="#è®¾ç½®æ°¸ä¹…ä»£-å…ƒç©ºé—´å¤§å°-permgen-metaspace"><span>è®¾ç½®æ°¸ä¹…ä»£/å…ƒç©ºé—´å¤§å° (PermGen/Metaspace)</span></a></h3><p><strong>ä» Java 8 å¼€å§‹ï¼Œå¦‚æœæˆ‘ä»¬æ²¡æœ‰æŒ‡å®š Metaspace çš„å¤§å°ï¼Œéšç€æ›´å¤šç±»çš„åˆ›å»ºï¼Œè™šæ‹Ÿæœºä¼šè€—å°½æ‰€æœ‰å¯ç”¨çš„ç³»ç»Ÿå†…å­˜ï¼ˆæ°¸ä¹…ä»£å¹¶ä¸ä¼šå‡ºç°è¿™ç§æƒ…å†µï¼‰ã€‚</strong></p><p>JDK 1.8 ä¹‹å‰æ°¸ä¹…ä»£è¿˜æ²¡è¢«å½»åº•ç§»é™¤çš„æ—¶å€™é€šå¸¸é€šè¿‡ä¸‹é¢è¿™äº›å‚æ•°æ¥è°ƒèŠ‚æ–¹æ³•åŒºå¤§å°</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">-XX:PermSize</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">=N</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #æ–¹æ³•åŒº (æ°¸ä¹…ä»£) åˆå§‹å¤§å°</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">-XX:MaxPermSize</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">=N</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #æ–¹æ³•åŒº (æ°¸ä¹…ä»£) æœ€å¤§å¤§å°,è¶…è¿‡è¿™ä¸ªå€¼å°†ä¼šæŠ›å‡º OutOfMemoryError å¼‚å¸¸:java.lang.OutOfMemoryError: PermGen</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>ç›¸å¯¹è€Œè¨€ï¼Œåƒåœ¾æ”¶é›†è¡Œä¸ºåœ¨è¿™ä¸ªåŒºåŸŸæ˜¯æ¯”è¾ƒå°‘å‡ºç°çš„ï¼Œä½†å¹¶éæ•°æ®è¿›å…¥æ–¹æ³•åŒºåå°±â€œæ°¸ä¹…å­˜åœ¨â€äº†ã€‚</p><p><strong>JDK 1.8 çš„æ—¶å€™ï¼Œæ–¹æ³•åŒºï¼ˆHotSpot çš„æ°¸ä¹…ä»£ï¼‰è¢«å½»åº•ç§»é™¤äº†ï¼ˆJDK1.7 å°±å·²ç»å¼€å§‹äº†ï¼‰ï¼Œå–è€Œä»£ä¹‹æ˜¯å…ƒç©ºé—´ï¼Œå…ƒç©ºé—´ä½¿ç”¨çš„æ˜¯æœ¬åœ°å†…å­˜ã€‚</strong></p><p>ä¸‹é¢æ˜¯ä¸€äº›å¸¸ç”¨å‚æ•°ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">-XX:MetaspaceSize</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">=N</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #è®¾ç½® Metaspace çš„åˆå§‹å¤§å°ï¼ˆæ˜¯ä¸€ä¸ªå¸¸è§çš„è¯¯åŒºï¼Œåé¢ä¼šè§£é‡Šï¼‰</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">-XX:MaxMetaspaceSize</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">=N</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #è®¾ç½® Metaspace çš„æœ€å¤§å¤§å°</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ğŸ› ä¿®æ­£ï¼ˆå‚è§ï¼š<a href="https://github.com/Snailclimb/JavaGuide/issues/1947" target="_blank" rel="noopener noreferrer">issue#1947</a>ï¼‰</strong>ï¼š</p><p><strong>1ã€<code>-XX:MetaspaceSize</code> å¹¶éåˆå§‹å®¹é‡ï¼š</strong> Metaspace çš„åˆå§‹å®¹é‡å¹¶ä¸æ˜¯ <code>-XX:MetaspaceSize</code> è®¾ç½®ï¼Œæ— è®º <code>-XX:MetaspaceSize</code> é…ç½®ä»€ä¹ˆå€¼ï¼Œå¯¹äº 64 ä½ JVMï¼Œå…ƒç©ºé—´çš„åˆå§‹å®¹é‡é€šå¸¸æ˜¯ä¸€ä¸ªå›ºå®šçš„è¾ƒå°å€¼ï¼ˆOracle æ–‡æ¡£æåˆ°çº¦ 12MB åˆ° 20MB ä¹‹é—´ï¼Œå®é™…è§‚å¯Ÿçº¦ 20.8MBï¼‰ã€‚</p><p>å¯ä»¥å‚è€ƒ Oracle å®˜æ–¹æ–‡æ¡£ <a href="https://docs.oracle.com/javase/8/docs/technotes/guides/vm/gctuning/considerations.html" target="_blank" rel="noopener noreferrer">Other Considerations</a> ä¸­æåˆ°çš„ï¼š</p><blockquote><p>Specify a higher value for the option MetaspaceSize to avoid early garbage collections induced for class metadata. The amount of class metadata allocated for an application is application-dependent and general guidelines do not exist for the selection of MetaspaceSize. The default size of MetaspaceSize is platform-dependent and ranges from 12 MB to about 20 MB.</p><p>MetaspaceSize çš„é»˜è®¤å¤§å°å–å†³äºå¹³å°ï¼ŒèŒƒå›´ä» 12 MB åˆ°å¤§çº¦ 20 MBã€‚</p></blockquote><p>å¦å¤–ï¼Œè¿˜å¯ä»¥çœ‹ä¸€ä¸‹è¿™ä¸ªè¯•éªŒï¼š<a href="https://mp.weixin.qq.com/s/jqfppqqd98DfAJHZhFbmxA" target="_blank" rel="noopener noreferrer">JVM å‚æ•° MetaspaceSize çš„è¯¯è§£</a>ã€‚</p><p><strong>2ã€æ‰©å®¹ä¸ Full GCï¼š</strong> å½“ Metaspace çš„ä½¿ç”¨é‡å¢é•¿å¹¶é¦–æ¬¡è¾¾åˆ°<code>-XX:MetaspaceSize</code> æŒ‡å®šçš„é˜ˆå€¼æ—¶ï¼Œä¼šè§¦å‘ä¸€æ¬¡ Full GCã€‚åœ¨æ­¤ä¹‹åï¼ŒJVM ä¼šåŠ¨æ€è°ƒæ•´è¿™ä¸ªè§¦å‘ GC çš„é˜ˆå€¼ã€‚å¦‚æœå…ƒç©ºé—´ç»§ç»­å¢é•¿ï¼Œæ¯æ¬¡è¾¾åˆ°æ–°çš„é˜ˆå€¼éœ€è¦æ‰©å®¹æ—¶ï¼Œä»ç„¶å¯èƒ½è§¦å‘ Full GCï¼ˆå…·ä½“è¡Œä¸ºä¸åƒåœ¾æ”¶é›†å™¨å’Œç‰ˆæœ¬æœ‰å…³ï¼‰ã€‚åƒåœ¾æœé›†å™¨å†…éƒ¨æ˜¯æ ¹æ®å˜é‡ <code>_capacity_until_GC</code>æ¥åˆ¤æ–­ Metaspace åŒºåŸŸæ˜¯å¦è¾¾åˆ°é˜ˆå€¼çš„ï¼Œåˆå§‹åŒ–ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" data-title="c" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">void</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> MetaspaceGC::</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">initialize</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // Set the high-water mark to MaxMetapaceSize during VM initialization since</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // we can&#39;t do a GC during initialization.</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  _capacity_until_GC </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> MaxMetaspaceSize;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>3ã€<code>-XX:MaxMetaspaceSize</code> çš„é‡è¦æ€§ï¼š<strong>å¦‚æœä¸æ˜¾å¼è®¾ç½® -<code>XX:MaxMetaspaceSize</code>ï¼Œå…ƒç©ºé—´çš„æœ€å¤§å¤§å°ç†è®ºä¸Šå—é™äºå¯ç”¨çš„æœ¬åœ°å†…å­˜ã€‚åœ¨æç«¯æƒ…å†µä¸‹ï¼ˆå¦‚ç±»åŠ è½½å™¨æ³„æ¼å¯¼è‡´ä¸æ–­åŠ è½½ç±»ï¼‰ï¼Œè¿™ç¡®å®</strong>å¯èƒ½è€—å°½å¤§é‡æœ¬åœ°å†…å­˜</strong>ã€‚å› æ­¤ï¼Œ<strong>å¼ºçƒˆå»ºè®®è®¾ç½®ä¸€ä¸ªåˆç†çš„ <code>-XX:MaxMetaspaceSize</code> ä¸Šé™</strong>ï¼Œä»¥é˜²æ­¢å¯¹ç³»ç»Ÿé€ æˆå½±å“ã€‚</p><p>ç›¸å…³é˜…è¯»ï¼š<a href="https://github.com/Snailclimb/JavaGuide/issues/1204" target="_blank" rel="noopener noreferrer">issue æ›´æ­£ï¼šMaxMetaspaceSize å¦‚æœä¸æŒ‡å®šå¤§å°çš„è¯ï¼Œä¸ä¼šè€—å°½å†…å­˜ #1204</a> ã€‚</p><h2 id="åƒåœ¾æ”¶é›†ç›¸å…³" tabindex="-1"><a class="header-anchor" href="#åƒåœ¾æ”¶é›†ç›¸å…³"><span>åƒåœ¾æ”¶é›†ç›¸å…³</span></a></h2><h3 id="é€‰æ‹©åƒåœ¾å›æ”¶å™¨" tabindex="-1"><a class="header-anchor" href="#é€‰æ‹©åƒåœ¾å›æ”¶å™¨"><span>é€‰æ‹©åƒåœ¾å›æ”¶å™¨</span></a></h3><p>é€‰æ‹©åˆé€‚çš„åƒåœ¾æ”¶é›†å™¨ï¼ˆGarbage Collector, GCï¼‰å¯¹äºåº”ç”¨çš„ååé‡å’Œå“åº”å»¶è¿Ÿè‡³å…³é‡è¦ã€‚å…³äºåƒåœ¾æ”¶é›†ç®—æ³•å’Œæ”¶é›†å™¨çš„è¯¦ç»†ä»‹ç»ï¼Œå¯ä»¥çœ‹ç¬”è€…å†™çš„è¿™ç¯‡ï¼š<a href="https://javaguide.cn/java/jvm/jvm-garbage-collection.html" target="_blank" rel="noopener noreferrer">JVM åƒåœ¾å›æ”¶è¯¦è§£ï¼ˆé‡ç‚¹ï¼‰</a>ã€‚</p><p>JVM æä¾›äº†å¤šç§ GC å®ç°ï¼Œé€‚ç”¨äºä¸åŒçš„åœºæ™¯ï¼š</p><ul><li><strong>Serial GC (ä¸²è¡Œåƒåœ¾æ”¶é›†å™¨):</strong> å•çº¿ç¨‹æ‰§è¡Œ GCï¼Œé€‚ç”¨äºå®¢æˆ·ç«¯æ¨¡å¼æˆ–å•æ ¸ CPU ç¯å¢ƒã€‚å‚æ•°ï¼š<code>-XX:+UseSerialGC</code>ã€‚</li><li><strong>Parallel GC (å¹¶è¡Œåƒåœ¾æ”¶é›†å™¨):</strong> å¤šçº¿ç¨‹æ‰§è¡Œæ–°ç”Ÿä»£ GC (Minor GC)ï¼Œä»¥åŠå¯é€‰çš„å¤šçº¿ç¨‹æ‰§è¡Œè€å¹´ä»£ GC (Full GCï¼Œé€šè¿‡ <code>-XX:+UseParallelOldGC</code>)ã€‚å…³æ³¨ååé‡ï¼Œæ˜¯ JDK 8 çš„é»˜è®¤ GCã€‚å‚æ•°ï¼š<code>-XX:+UseParallelGC</code>ã€‚</li><li><strong>CMS GC (Concurrent Mark Sweep å¹¶å‘æ ‡è®°æ¸…é™¤æ”¶é›†å™¨):</strong> ä»¥è·å–æœ€çŸ­å›æ”¶åœé¡¿æ—¶é—´ä¸ºç›®æ ‡ï¼Œå¤§éƒ¨åˆ† GC é˜¶æ®µå¯ä¸ç”¨æˆ·çº¿ç¨‹å¹¶å‘æ‰§è¡Œã€‚é€‚ç”¨äºå¯¹å“åº”æ—¶é—´è¦æ±‚é«˜çš„åº”ç”¨ã€‚åœ¨ JDK 9 ä¸­è¢«æ ‡è®°ä¸ºå¼ƒç”¨ï¼ŒJDK 14 ä¸­è¢«ç§»é™¤ã€‚å‚æ•°ï¼š<code>-XX:+UseConcMarkSweepGC</code>ã€‚</li><li><strong>G1 GC (Garbage-First Garbage Collector):</strong> JDK 9 åŠä¹‹åç‰ˆæœ¬çš„é»˜è®¤ GCã€‚å°†å †åˆ’åˆ†ä¸ºå¤šä¸ª Regionï¼Œå…¼é¡¾ååé‡å’Œåœé¡¿æ—¶é—´ï¼Œè¯•å›¾åœ¨å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´å†…å®Œæˆ GCã€‚å‚æ•°ï¼š<code>-XX:+UseG1GC</code>ã€‚</li><li><strong>ZGC:</strong> æ›´æ–°çš„ä½å»¶è¿Ÿ GCï¼Œç›®æ ‡æ˜¯å°† GC åœé¡¿æ—¶é—´æ§åˆ¶åœ¨å‡ æ¯«ç§’ç”šè‡³äºšæ¯«ç§’çº§åˆ«ï¼Œéœ€è¦è¾ƒæ–°ç‰ˆæœ¬çš„ JDK æ”¯æŒã€‚å‚æ•°ï¼ˆå…·ä½“å‚æ•°å¯èƒ½éšç‰ˆæœ¬å˜åŒ–ï¼‰ï¼š<code>-XX:+UseZGC</code>ã€<code>-XX:+UseShenandoahGC</code>ã€‚</li></ul><h3 id="gc-æ—¥å¿—è®°å½•" tabindex="-1"><a class="header-anchor" href="#gc-æ—¥å¿—è®°å½•"><span>GC æ—¥å¿—è®°å½•</span></a></h3><p>åœ¨ç”Ÿäº§ç¯å¢ƒæˆ–è¿›è¡Œ GC é—®é¢˜æ’æŸ¥æ—¶ï¼Œ<strong>åŠ¡å¿…å¼€å¯ GC æ—¥å¿—è®°å½•</strong>ã€‚è¯¦ç»†çš„ GC æ—¥å¿—æ˜¯åˆ†æå’Œè§£å†³ GC é—®é¢˜çš„å…³é”®ä¾æ®ã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€äº›æ¨èé…ç½®çš„ GC æ—¥å¿—å‚æ•°ï¼ˆé€‚ç”¨äº JDK 8/11 ç­‰å¸¸è§ç‰ˆæœ¬ï¼‰ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># --- æ¨èçš„åŸºç¡€é…ç½® ---</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># æ‰“å°è¯¦ç»† GC ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">-XX:+PrintGCDetails</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># æ‰“å° GC å‘ç”Ÿçš„æ—¶é—´æˆ³ (ç›¸å¯¹äº JVM å¯åŠ¨æ—¶é—´)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># -XX:+PrintGCTimeStamps</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># æ‰“å° GC å‘ç”Ÿçš„æ—¥æœŸå’Œæ—¶é—´ (æ›´å¸¸ç”¨)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">-XX:+PrintGCDateStamps</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># æŒ‡å®š GC æ—¥å¿—æ–‡ä»¶çš„è¾“å‡ºè·¯å¾„ï¼Œ%t å¯ä»¥è¾“å‡ºæ—¥æœŸæ—¶é—´æˆ³</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">-Xloggc:/path/to/gc-%t.log</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># --- æ¨èçš„è¿›é˜¶é…ç½® ---</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># æ‰“å°å¯¹è±¡å¹´é¾„åˆ†å¸ƒ (æœ‰åŠ©äºåˆ¤æ–­å¯¹è±¡æ™‹å‡è€å¹´ä»£çš„æƒ…å†µ)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">-XX:+PrintTenuringDistribution</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># åœ¨ GC å‰åæ‰“å°å †ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">-XX:+PrintHeapAtGC</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># æ‰“å°å„ç§ç±»å‹å¼•ç”¨ (å¼º/è½¯/å¼±/è™š) çš„å¤„ç†ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">-XX:+PrintReferenceGC</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># æ‰“å°åº”ç”¨æš‚åœæ—¶é—´ (Stop-The-World, STW)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">-XX:+PrintGCApplicationStoppedTime</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># --- GC æ—¥å¿—æ–‡ä»¶æ»šåŠ¨é…ç½® ---</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># å¯ç”¨ GC æ—¥å¿—æ–‡ä»¶æ»šåŠ¨</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">-XX:+UseGCLogFileRotation</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># è®¾ç½®æ»šåŠ¨æ—¥å¿—æ–‡ä»¶çš„æ•°é‡ (ä¾‹å¦‚ï¼Œä¿ç•™æœ€è¿‘ 14 ä¸ª)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">-XX:NumberOfGCLogFiles</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">=14</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># è®¾ç½®æ¯ä¸ªæ—¥å¿—æ–‡ä»¶çš„æœ€å¤§å¤§å° (ä¾‹å¦‚ï¼Œ50MB)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">-XX:GCLogFileSize</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">=50M</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># --- å¯é€‰çš„è¾…åŠ©è¯Šæ–­é…ç½® ---</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># æ‰“å°å®‰å…¨ç‚¹ (Safepoint) ç»Ÿè®¡ä¿¡æ¯ (æœ‰åŠ©äºåˆ†æ STW åŸå› )</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># -XX:+PrintSafepointStatistics</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># -XX:PrintSafepointStatisticsCount=1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ³¨æ„:</strong> JDK 9 åŠä¹‹åç‰ˆæœ¬å¼•å…¥äº†ç»Ÿä¸€çš„ JVM æ—¥å¿—æ¡†æ¶ (<code>-Xlog</code>)ï¼Œé…ç½®æ–¹å¼æœ‰æ‰€ä¸åŒï¼Œä½†ä¸Šè¿° <code>-Xloggc</code> å’Œæ»šåŠ¨å‚æ•°é€šå¸¸ä»ç„¶å…¼å®¹æˆ–æœ‰å¯¹åº”çš„æ–°å‚æ•°ã€‚</p><h2 id="å¤„ç†-oom" tabindex="-1"><a class="header-anchor" href="#å¤„ç†-oom"><span>å¤„ç† OOM</span></a></h2><p>å¯¹äºå¤§å‹åº”ç”¨ç¨‹åºæ¥è¯´ï¼Œé¢å¯¹å†…å­˜ä¸è¶³é”™è¯¯æ˜¯éå¸¸å¸¸è§çš„ï¼Œè¿™åè¿‡æ¥ä¼šå¯¼è‡´åº”ç”¨ç¨‹åºå´©æºƒã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸å…³é”®çš„åœºæ™¯ï¼Œå¾ˆéš¾é€šè¿‡å¤åˆ¶æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ JVM æä¾›äº†ä¸€äº›å‚æ•°ï¼Œè¿™äº›å‚æ•°å°†å †å†…å­˜è½¬å‚¨åˆ°ä¸€ä¸ªç‰©ç†æ–‡ä»¶ä¸­ï¼Œä»¥åå¯ä»¥ç”¨æ¥æŸ¥æ‰¾æ³„æ¼:</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># åœ¨å‘ç”Ÿ OOM æ—¶ç”Ÿæˆå †è½¬å‚¨æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">-XX:+HeapDumpOnOutOfMemoryError</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># æŒ‡å®šå †è½¬å‚¨æ–‡ä»¶çš„è¾“å‡ºè·¯å¾„ã€‚&lt;pid&gt; ä¼šè¢«æ›¿æ¢ä¸ºè¿›ç¨‹ ID</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">-XX:HeapDumpPath</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">=/path/to/heapdump/java_pid</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;pid&gt;.hprof</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ç¤ºä¾‹ï¼š-XX:HeapDumpPath=/data/dumps/</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># (å¯é€‰) åœ¨å‘ç”Ÿ OOM æ—¶æ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤æˆ–è„šæœ¬</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ä¾‹å¦‚ï¼Œå‘é€å‘Šè­¦é€šçŸ¥æˆ–å°è¯•é‡å¯æœåŠ¡ï¼ˆéœ€è°¨æ…ä½¿ç”¨ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># -XX:OnOutOfMemoryError=&quot;&lt;command&gt; &lt;args&gt;&quot;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ç¤ºä¾‹ï¼š-XX:OnOutOfMemoryError=&quot;sh /path/to/notify.sh&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># (å¯é€‰) å¯ç”¨ GC å¼€é”€é™åˆ¶æ£€æŸ¥</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># å¦‚æœ GC æ—¶é—´å æ€»æ—¶é—´æ¯”ä¾‹è¿‡é«˜ï¼ˆé»˜è®¤ 98%ï¼‰ä¸”å›æ”¶æ•ˆæœç”šå¾®ï¼ˆé»˜è®¤å°äº 2% å †å†…å­˜ï¼‰ï¼Œ</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ä¼šæå‰æŠ›å‡º OOMï¼Œé˜²æ­¢åº”ç”¨é•¿æ—¶é—´å¡æ­»åœ¨ GC ä¸­ã€‚</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">-XX:+UseGCOverheadLimit</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="å…¶ä»–å¸¸ç”¨å‚æ•°" tabindex="-1"><a class="header-anchor" href="#å…¶ä»–å¸¸ç”¨å‚æ•°"><span>å…¶ä»–å¸¸ç”¨å‚æ•°</span></a></h2><ul><li><code>-server</code>: æ˜ç¡®å¯ç”¨ Server æ¨¡å¼çš„ HotSpot VMã€‚ï¼ˆåœ¨ 64 ä½ JVM ä¸Šé€šå¸¸æ˜¯é»˜è®¤å€¼ï¼‰ã€‚</li><li><code>-XX:+UseStringDeduplication</code>: (JDK 8u20+) å°è¯•è¯†åˆ«å¹¶å…±äº«åº•å±‚ <code>char[]</code> æ•°ç»„ç›¸åŒçš„ String å¯¹è±¡ï¼Œä»¥å‡å°‘å†…å­˜å ç”¨ã€‚é€‚ç”¨äºå­˜åœ¨å¤§é‡é‡å¤å­—ç¬¦ä¸²çš„åœºæ™¯ã€‚</li><li><code>-XX:SurvivorRatio=&lt;ratio&gt;</code>: è®¾ç½® Eden åŒºä¸å•ä¸ª Survivor åŒºçš„å¤§å°æ¯”ä¾‹ã€‚ä¾‹å¦‚ <code>-XX:SurvivorRatio=8</code> è¡¨ç¤º Eden:Survivor = 8:1ã€‚</li><li><code>-XX:MaxTenuringThreshold=&lt;threshold&gt;</code>: è®¾ç½®å¯¹è±¡ä»æ–°ç”Ÿä»£æ™‹å‡åˆ°è€å¹´ä»£çš„æœ€å¤§å¹´é¾„é˜ˆå€¼ï¼ˆå¯¹è±¡æ¯ç»å†ä¸€æ¬¡ Minor GC ä¸”å­˜æ´»ï¼Œå¹´é¾„åŠ  1ï¼‰ã€‚é»˜è®¤å€¼é€šå¸¸æ˜¯ 15ã€‚</li><li><code>-XX:+DisableExplicitGC</code>: ç¦æ­¢ä»£ç ä¸­æ˜¾å¼è°ƒç”¨ <code>System.gc()</code>ã€‚æ¨èå¼€å¯ï¼Œé¿å…äººä¸ºè§¦å‘ä¸å¿…è¦çš„ Full GCã€‚</li><li><code>-XX:+UseLargePages</code>: (éœ€è¦æ“ä½œç³»ç»Ÿæ”¯æŒ) å°è¯•ä½¿ç”¨å¤§å†…å­˜é¡µï¼ˆå¦‚ 2MB è€Œé 4KBï¼‰ï¼Œå¯èƒ½æå‡å†…å­˜å¯†é›†å‹åº”ç”¨çš„æ€§èƒ½ï¼Œä½†éœ€è°¨æ…æµ‹è¯•ã€‚</li><li>-<code>XX:MinHeapFreeRatio=&lt;percent&gt; / -XX:MaxHeapFreeRatio=&lt;percent&gt;</code>: æ§åˆ¶ GC åå †å†…å­˜ä¿æŒç©ºé—²çš„æœ€å°/æœ€å¤§ç™¾åˆ†æ¯”ï¼Œç”¨äºåŠ¨æ€è°ƒæ•´å †å¤§å°ï¼ˆå¦‚æœ <code>-Xms</code> å’Œ <code>-Xmx</code> ä¸ç›¸ç­‰ï¼‰ã€‚é€šå¸¸å»ºè®®å°† <code>-Xms</code> å’Œ <code>-Xmx</code> è®¾ä¸ºä¸€è‡´ï¼Œé¿å…è°ƒæ•´å¼€é”€ã€‚</li></ul><p><strong>æ³¨æ„ï¼š</strong> ä»¥ä¸‹å‚æ•°åœ¨ç°ä»£ JVM ç‰ˆæœ¬ä¸­å¯èƒ½å·²<strong>å¼ƒç”¨ã€ç§»é™¤æˆ–é»˜è®¤å¼€å¯ä¸”æ— éœ€æ‰‹åŠ¨è®¾ç½®</strong>ï¼š</p><ul><li><code>-XX:+UseLWPSynchronization</code>: è¾ƒæ—§çš„åŒæ­¥ç­–ç•¥é€‰é¡¹ï¼Œç°ä»£ JVM é€šå¸¸æœ‰æ›´ä¼˜åŒ–çš„å®ç°ã€‚</li><li><code>-XX:LargePageSizeInBytes</code>: é€šå¸¸ç”± <code>-XX:+UseLargePages</code> è‡ªåŠ¨ç¡®å®šæˆ–é€šè¿‡ OS é…ç½®ã€‚</li><li><code>-XX:+UseStringCache</code>: å·²è¢«ç§»é™¤ã€‚</li><li><code>-XX:+UseCompressedStrings</code>: å·²è¢« Java 9 åŠä¹‹åé»˜è®¤å¼€å¯çš„ Compact Strings ç‰¹æ€§å–ä»£ã€‚</li><li><code>-XX:+OptimizeStringConcat</code>: å­—ç¬¦ä¸²è¿æ¥ä¼˜åŒ–ï¼ˆinvokedynamicï¼‰åœ¨ Java 9 åŠä¹‹åæ˜¯é»˜è®¤è¡Œä¸ºã€‚</li></ul><h2 id="æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“"><span>æ€»ç»“</span></a></h2><p>æœ¬æ–‡ä¸º Java å¼€å‘è€…æä¾›äº†ä¸€ä»½å®ç”¨çš„ JVM å¸¸ç”¨å‚æ•°é…ç½®æŒ‡å—ï¼Œæ—¨åœ¨å¸®åŠ©è¯»è€…ç†è§£å’Œä¼˜åŒ– Java åº”ç”¨çš„æ€§èƒ½ä¸ç¨³å®šæ€§ã€‚æ–‡ç« é‡ç‚¹å¼ºè°ƒäº†ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</p><ol><li><strong>å †å†…å­˜é…ç½®ï¼š</strong> å»ºè®®æ˜¾å¼è®¾ç½®åˆå§‹ä¸æœ€å¤§å †å†…å­˜ (<code>-Xms</code>, -<code>Xmx</code>ï¼Œé€šå¸¸è®¾ä¸ºä¸€è‡´) å’Œæ–°ç”Ÿä»£å¤§å° (<code>-Xmn</code> æˆ– <code>-XX:NewSize/-XX:MaxNewSize</code>)ï¼Œè¿™å¯¹ GC æ€§èƒ½è‡³å…³é‡è¦ã€‚</li><li><strong>å…ƒç©ºé—´ç®¡ç† (Java 8+)ï¼š</strong> æ¾„æ¸…äº† <code>-XX:MetaspaceSize</code> çš„å®é™…ä½œç”¨ï¼ˆé¦–æ¬¡è§¦å‘ Full GC çš„é˜ˆå€¼ï¼Œè€Œéåˆå§‹å®¹é‡ï¼‰ï¼Œå¹¶å¼ºçƒˆå»ºè®®è®¾ç½® <code>-XX:MaxMetaspaceSize</code> ä»¥é˜²æ­¢æ½œåœ¨çš„æœ¬åœ°å†…å­˜è€—å°½ã€‚</li><li>**åƒåœ¾æ”¶é›†å™¨é€‰æ‹©ä¸æ—¥å¿—ï¼š**ä»‹ç»äº†ä¸åŒ GC ç®—æ³•çš„é€‚ç”¨åœºæ™¯ï¼Œå¹¶å¼ºè°ƒåœ¨ç”Ÿäº§å’Œæµ‹è¯•ç¯å¢ƒä¸­å¼€å¯è¯¦ç»† GC æ—¥å¿— (<code>-Xloggc</code>, <code>-XX:+PrintGCDetails</code> ç­‰) å¯¹äºé—®é¢˜æ’æŸ¥çš„å¿…è¦æ€§ã€‚</li><li><strong>OOM æ•…éšœæ’æŸ¥ï¼š</strong> è¯´æ˜äº†å¦‚ä½•é€šè¿‡ <code>-XX:+HeapDumpOnOutOfMemoryError</code> ç­‰å‚æ•°åœ¨å‘ç”Ÿ OOM æ—¶è‡ªåŠ¨ç”Ÿæˆå †è½¬å‚¨æ–‡ä»¶ï¼Œä»¥ä¾¿è¿›è¡Œåç»­çš„å†…å­˜æ³„æ¼åˆ†æã€‚</li><li><strong>å…¶ä»–å‚æ•°ï¼š</strong> ç®€è¦ä»‹ç»äº†å¦‚å­—ç¬¦ä¸²å»é‡ç­‰å…¶ä»–æœ‰ç”¨å‚æ•°ï¼Œå¹¶æŒ‡å‡ºäº†éƒ¨åˆ†æ—§å‚æ•°çš„ç°çŠ¶ã€‚</li></ol><p>å…·ä½“çš„é—®é¢˜æ’æŸ¥å’Œè°ƒä¼˜æ¡ˆä¾‹ï¼Œå¯ä»¥å‚è€ƒç¬”è€…æ•´ç†çš„è¿™ç¯‡æ–‡ç« ï¼š<a href="https://javaguide.cn/java/jvm/jvm-in-action.html" target="_blank" rel="noopener noreferrer">JVM çº¿ä¸Šé—®é¢˜æ’æŸ¥å’Œæ€§èƒ½è°ƒä¼˜æ¡ˆä¾‹</a>ã€‚</p><p><img src="https://oss.javaguide.cn/github/javaguide/gongzhonghaoxuanchuan.png" alt="JavaGuide å®˜æ–¹å…¬ä¼—å·"></p>`,67)]))}const p=s(l,[["render",r],["__file","jvm-parameters-intro.html.vue"]]),c=JSON.parse('{"path":"/java/jvm/jvm-parameters-intro.html","title":"æœ€é‡è¦çš„JVMå‚æ•°æ€»ç»“","lang":"zh-CN","frontmatter":{"title":"æœ€é‡è¦çš„JVMå‚æ•°æ€»ç»“","category":"Java","tag":["JVM"],"description":"æœ¬æ–‡ç”± JavaGuide ç¿»è¯‘è‡ª https://www.baeldung.com/jvm-parametersï¼Œå¹¶å¯¹æ–‡ç« è¿›è¡Œäº†å¤§é‡çš„å®Œå–„è¡¥å……ã€‚ æ–‡æ¡£å‚æ•° https://docs.oracle.com/javase/8/docs/technotes/tools/unix/java.html JDK ç‰ˆæœ¬ï¼š1.8 ä¸ºä¸»ï¼Œä¹Ÿä¼šè¡¥å……æ–°ç‰ˆæœ¬å¸¸ç”¨å‚æ•° åœ¨æœ¬ç¯‡...","head":[["meta",{"property":"og:url","content":"https://javaguide.cn/java/jvm/jvm-parameters-intro.html"}],["meta",{"property":"og:site_name","content":"JavaGuide"}],["meta",{"property":"og:title","content":"æœ€é‡è¦çš„JVMå‚æ•°æ€»ç»“"}],["meta",{"property":"og:description","content":"æœ¬æ–‡ç”± JavaGuide ç¿»è¯‘è‡ª https://www.baeldung.com/jvm-parametersï¼Œå¹¶å¯¹æ–‡ç« è¿›è¡Œäº†å¤§é‡çš„å®Œå–„è¡¥å……ã€‚ æ–‡æ¡£å‚æ•° https://docs.oracle.com/javase/8/docs/technotes/tools/unix/java.html JDK ç‰ˆæœ¬ï¼š1.8 ä¸ºä¸»ï¼Œä¹Ÿä¼šè¡¥å……æ–°ç‰ˆæœ¬å¸¸ç”¨å‚æ•° åœ¨æœ¬ç¯‡..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-04-24T23:41:01.000Z"}],["meta",{"property":"article:tag","content":"JVM"}],["meta",{"property":"article:modified_time","content":"2025-04-24T23:41:01.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"æœ€é‡è¦çš„JVMå‚æ•°æ€»ç»“\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-04-24T23:41:01.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Guide\\",\\"url\\":\\"https://javaguide.cn/article/\\"}]}"]]},"headers":[{"level":2,"title":"å †å†…å­˜ç›¸å…³","slug":"å †å†…å­˜ç›¸å…³","link":"#å †å†…å­˜ç›¸å…³","children":[{"level":3,"title":"è®¾ç½®å †å†…å­˜å¤§å° (-Xms å’Œ -Xmx)","slug":"è®¾ç½®å †å†…å­˜å¤§å°-xms-å’Œ-xmx","link":"#è®¾ç½®å †å†…å­˜å¤§å°-xms-å’Œ-xmx","children":[]},{"level":3,"title":"è®¾ç½®æ–°ç”Ÿä»£å†…å­˜å¤§å° (Young Generation)","slug":"è®¾ç½®æ–°ç”Ÿä»£å†…å­˜å¤§å°-young-generation","link":"#è®¾ç½®æ–°ç”Ÿä»£å†…å­˜å¤§å°-young-generation","children":[]},{"level":3,"title":"è®¾ç½®æ°¸ä¹…ä»£/å…ƒç©ºé—´å¤§å° (PermGen/Metaspace)","slug":"è®¾ç½®æ°¸ä¹…ä»£-å…ƒç©ºé—´å¤§å°-permgen-metaspace","link":"#è®¾ç½®æ°¸ä¹…ä»£-å…ƒç©ºé—´å¤§å°-permgen-metaspace","children":[]}]},{"level":2,"title":"åƒåœ¾æ”¶é›†ç›¸å…³","slug":"åƒåœ¾æ”¶é›†ç›¸å…³","link":"#åƒåœ¾æ”¶é›†ç›¸å…³","children":[{"level":3,"title":"é€‰æ‹©åƒåœ¾å›æ”¶å™¨","slug":"é€‰æ‹©åƒåœ¾å›æ”¶å™¨","link":"#é€‰æ‹©åƒåœ¾å›æ”¶å™¨","children":[]},{"level":3,"title":"GC æ—¥å¿—è®°å½•","slug":"gc-æ—¥å¿—è®°å½•","link":"#gc-æ—¥å¿—è®°å½•","children":[]}]},{"level":2,"title":"å¤„ç† OOM","slug":"å¤„ç†-oom","link":"#å¤„ç†-oom","children":[]},{"level":2,"title":"å…¶ä»–å¸¸ç”¨å‚æ•°","slug":"å…¶ä»–å¸¸ç”¨å‚æ•°","link":"#å…¶ä»–å¸¸ç”¨å‚æ•°","children":[]},{"level":2,"title":"æ€»ç»“","slug":"æ€»ç»“","link":"#æ€»ç»“","children":[]}],"git":{"createdTime":1574417829000,"updatedTime":1745538061000,"contributors":[{"name":"Snailclimb","username":"Snailclimb","email":"koushuangbwcx@163.com","commits":1,"url":"https://github.com/Snailclimb"},{"name":"guide","username":"guide","email":"koushuangbwcx@163.com","commits":7,"url":"https://github.com/guide"},{"name":"ly","username":"ly","email":"37680485+drlifeL@users.noreply.github.com","commits":1,"url":"https://github.com/ly"},{"name":"TommyMerlin","username":"TommyMerlin","email":"786731256@qq.com","commits":1,"url":"https://github.com/TommyMerlin"},{"name":"1036956372","username":"1036956372","email":"31445575+1036956372@users.noreply.github.com","commits":1,"url":"https://github.com/1036956372"},{"name":"Guide","username":"Guide","email":"koushuangbwcx@163.com","commits":9,"url":"https://github.com/Guide"},{"name":"Erzbir","username":"Erzbir","email":"2978086497@qq.com","commits":1,"url":"https://github.com/Erzbir"},{"name":"Mr.Hope","username":"Mr.Hope","email":"mister-hope@outlook.com","commits":5,"url":"https://github.com/Mr.Hope"},{"name":"paigeman","username":"paigeman","email":"53284808+paigeman@users.noreply.github.com","commits":2,"url":"https://github.com/paigeman"},{"name":"aucub","username":"aucub","email":"78630225+aucub@users.noreply.github.com","commits":1,"url":"https://github.com/aucub"},{"name":"seven17777777","username":"seven17777777","email":"167538235+seven17777777@users.noreply.github.com","commits":1,"url":"https://github.com/seven17777777"},{"name":"hulingfeng","username":"hulingfeng","email":"1405559058@qq.com","commits":2,"url":"https://github.com/hulingfeng"},{"name":"ä¸€åªå’•å’•é±¼","username":"ä¸€åªå’•å’•é±¼","email":"50142521+1312255201@users.noreply.github.com","commits":1,"url":"https://github.com/ä¸€åªå’•å’•é±¼"}]},"readingTime":{"minutes":10.91,"words":3272},"filePathRelative":"java/jvm/jvm-parameters-intro.md","localizedDate":"2019å¹´11æœˆ22æ—¥","excerpt":"<blockquote>\\n<p>æœ¬æ–‡ç”± JavaGuide ç¿»è¯‘è‡ª <a href=\\"https://www.baeldung.com/jvm-parameters\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">https://www.baeldung.com/jvm-parameters</a>ï¼Œå¹¶å¯¹æ–‡ç« è¿›è¡Œäº†å¤§é‡çš„å®Œå–„è¡¥å……ã€‚<br>\\næ–‡æ¡£å‚æ•° <a href=\\"https://docs.oracle.com/javase/8/docs/technotes/tools/unix/java.html\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">https://docs.oracle.com/javase/8/docs/technotes/tools/unix/java.html</a></p>\\n<p>JDK ç‰ˆæœ¬ï¼š1.8 ä¸ºä¸»ï¼Œä¹Ÿä¼šè¡¥å……æ–°ç‰ˆæœ¬å¸¸ç”¨å‚æ•°</p>\\n</blockquote>","autoDesc":true}');export{p as comp,c as data};
